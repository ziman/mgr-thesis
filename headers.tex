\documentclass[12pt,a4paper,twoside,openright,reqno]{book}

\setlength{\headsep}{3em}
\setlength{\headheight}{15pt}
\let\openright=\cleardoublepage

\usepackage{etex}

%% Ostatní balíčky
%\usepackage[natbib=false]{biblatex}
%\bibliography{dotbibfile}
\usepackage{graphicx}
\usepackage{amsmath, amsthm}
%\usepackage{amssymb, amsfonts} not compatible with Minion Pro
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
%\usepackage[all,cmtip]{xy}
\usepackage{textcomp}
%\usepackage{subfloat}
\usepackage{graphicx}
\usepackage{lmodern}
\usepackage{microtype}
\usepackage[utf8]{inputenc}
\usepackage{booktabs}
%\usepackage{a4wide}
\usepackage{comment}
\usepackage{array}
\usepackage{subcaption}
%\usepackage{natbib}
%\usepackage{tgpagella}
%\usepackage{tgcursor}
\usepackage[textosf,mathlf]{MinionPro}
%\usepackage{wrapfig}
\usepackage{bussproofs}
\usepackage{titlesec}
\usepackage{fancyref}
\usepackage{tikz}
\usetikzlibrary{decorations.pathreplacing,patterns}

\makeatletter
  \def\vhrulefill#1{\leavevmode\leaders\hrule\@height#1\hfill \kern\z@}
\makeatother

\usepackage{fancyhdr}
\fancypagestyle{fancypg}{%
\lhead[\thepage]{\textsc{\nouppercase{\rightmark}}}%
\rhead[\textsc{\nouppercase{\leftmark}}]{\thepage}%
\cfoot[]{}%
}

% make chapter pages numberless
\fancypagestyle{plain}{ %
\fancyhf{} % remove everything
\renewcommand{\headrulewidth}{0pt} % remove lines as well
\renewcommand{\footrulewidth}{0pt} %
}

\titleformat{\chapter}[display]%
{\flushright\rm}%
{\scshape\Large Chapter\Huge\hspace{0.5em}$\thechapter$}%
{20pt}%
{\vhrulefill{2pt}\vspace{11pt}\\\itshape\LARGE}%
[\vspace{-2pt}\hrulefill]

\titleformat{\section}[block]{\centering\rm\itshape}{\Large\thesection}{1ex}{\Large}
\titlespacing*{\section}{0ex}{20pt}{10pt}
\titleformat{\subsection}{\rm}{\large\thesubsection}{1ex}{\large}
\titlespacing*{\subsection}{0ex}{23pt}{10pt}
\titleformat{\subsubsection}{\rm\sscshape}{}{0ex}{}
\titlespacing*{\subsubsection}{0ex}{18pt}{8pt}

\setcounter{secnumdepth}{2} % 3 = subsubsections, too

\makeatletter
 \def\@textbottom{\vskip \z@ \@plus 14pt}
 \let\@texttop\relax
\makeatother

\newcommand{\scons}{:-:\;}
\newcommand{\sconsh}{!-!\;}
\newcommand{\void}{$\square$}
\newcommand{\tick}{$\checkmark$}
\newcommand{\bN}{\mathbb{N}}
\newcommand{\excp}{\;!\:}

\usepackage{listings}
\lstloadlanguages{Haskell}
\lstdefinestyle{agda}{
      comment=[l]--,
      basicstyle=\small\sffamily,
      keywordstyle=\bf\sffamily,
      commentstyle=\color{gray}\it\rmfamily,
      tabsize=4,
      basewidth={0.5em,0.45em},
      escapechar=&,
      xleftmargin=9pt,
      morekeywords={data,where,open,import,let,with,module,using,infixr,rewrite,mutual,in,case,of},
      literate=
      	{+}{{$+\;$}}1
      	{/}{{$/$}}1
      	{*}{{$*$}}1
      	{=}{{$=\;$}}1
        {>}{{$>$}}1
        {<}{{$<$}}1
        {\\lam}{{$\lambda$}}1
        {\\\\}{{\char`\\\char`\\}}1
       	{->}{{$\rightarrow\;$}}2
       	{>=}{{$\geq$}}2
       	{<-}{{$\leftarrow$}}2
        {<=}{{$\leq$}}2
        {=>}{{$\Rightarrow\;$}}2 
        {\\...}{{$\cdots\;$}}2
        {\ .}{{$\circ$}}2
        {\ .\ }{{$\circ$}}2
        {>>}{{>>}}2
        {>>=}{{>>=}}2
        {|}{{$\mid\:$}}1
        {Nat}{{$\mathbb{N}\;$}}1
        {forall}{{$\forall\;$}}1
        {\\scons}{{\scons}}1
        {\\sconsh}{{\sconsh}}1
        {\\void}{{\void}}1
	{\\o}{{$\circ\;$}}1
        {\\tick}{{\tick}}1
	  	{\\nil}{{$\varepsilon\;$}}1
	  	{\\bN}{{$\bN\;$}}1
	  	{\\x}{{$\times$}}1
	  	{\\excp}{{\excp}}1
	  	{==}{{$\equiv\;$}}1
		{<|}{{$\lhd\;\,$}}1
        {\\app}{{$\lhd\!\lhd\;\,$}}1
	{\\and}{{$\wedge\;$}}1
	{\\leq}{{$\leq\;$}}1
        {~}{{$\neg\:$}}1
        {[[}{{[\![\;}}1
        {]]}{{]\!]\;}}1
        {\\;}{{\;}}1
        {\\-}{{-}}1
        {\\qed}{{$\qed$}}1
        {==<}{{$\equiv\!\!\langle\;$}}1
        {\\>}{{$\rangle$}}1
        {\\_}{{\!\!\_}}1
}
\lstnewenvironment{code}
	{\lstset{style=agda,columns=fullflexible}\csname lst@SetFirstLabel\endcsname}
	{\csname lst@SaveFirstLabel\endcsname}
\lstnewenvironment{codei}
	{\lstset{style=agda,columns=flexible}\csname lst@SetFirstLabel\endcsname}
	{\csname lst@SaveFirstLabel\endcsname}
\lstnewenvironment{codepy}
	{\lstset{language=Python,columns=fullflexible}\csname lst@SetFirstLabel\endcsname}
	{\csname lst@SaveFirstLabel\endcsname}
\lstnewenvironment{codejava}
	{\lstset{language=Java,columns=fullflexible}\csname lst@SetFirstLabel\endcsname}
	{\csname lst@SaveFirstLabel\endcsname}
\lstnewenvironment{codehs}
	{\lstset{language=Haskell,columns=fullflexible,morekeywords={finally}}%
	   \csname lst@SetFirstLabel\endcsname}
	{\csname lst@SaveFirstLabel\endcsname}
\lstnewenvironment{codeml}
	{\lstset{language=Caml,columns=fullflexible,escapechar=&,morekeywords={raise}}\csname lst@SetFirstLabel\endcsname}
	{\csname lst@SaveFirstLabel\endcsname}
   
\newcommand{\bin}[1]{\_#1\!\!\_}

\usepackage{color}
\definecolor{link}{rgb}{0,0,0.5}
\usepackage[colorlinks=true,linkcolor=link,urlcolor=link,citecolor=link,unicode]{hyperref}
\hypersetup{pdftitle=On the semantics of exceptions for high level and low level languages}
\hypersetup{pdfauthor=Matus Tejiscak}

% Toto makro definuje kapitolu, která není očíslovaná, ale je uvedena v obsahu.
\def\chapwithtoc#1{
\chapter*{#1}
\addcontentsline{toc}{chapter}{#1}
}

\newcommand{\identsize}{\small}
\newcommand{\ident}[1]{\mbox{\textsf{\identsize #1}}}
\newcommand{\midt}[1]{\mathsf{#1}}
\newcommand{\cident}[1]{\textsf{\textit{\color{gray}#1}}} % for comments in code

% use \footnotesize identifier size in footnotes
\let\origfootnote\footnote
\let\origidentsize\identsize
\renewcommand{\footnote}[1]{%
   \renewcommand\identsize\footnotesize%
   \origfootnote{#1}%
   \renewcommand\identsize\origidentsize%
}

\newcommand{\lrule}[2]{%
  \noindent\hbox{{\vrule width #1}\hskip 0.5em\vbox{\noindent #2}}%
}

%\newcommand{\myinset}[1]{\begin{wrapfigure}{r}{0.25\textwidth}%
%\vspace{-1em}%
%\parbox{0.228\textwidth}{%
%\lrule{0.5pt}{\raggedright\footnotesize\sloppy #1\fussy}%
%}\vspace{-1em}%
%\end{wrapfigure}%
%}

% don't forget to comment \usepackage{a4wide} if you use this
%\newcommand{\marinset}[1]{\marginpar{\raisebox{-1.3\baselineskip}{%
%\begin{minipage}[t]{\marginparwidth}%
%\noindent \raggedright \footnotesize #1%
%\end{minipage}%
%}}}

%\newcommand{\inset}[1]{\myinset{#1}}
\newcommand{\mnote}[1]{\marginpar{\footnotesize \textit{#1}}}
%\newcommand{\note}[1]{\marginpar{\lrule{0.5pt}{\footnotesize \textit{#1}}}}
\newcommand{\todo}[1]{\textssc{Todo.} \textit{#1}}
\newcommand{\note}[1]{\textsc{Note.}\, #1}

\newcommand{\infixl}{\textbf{infixl}}
\newcommand{\infixr}{\textbf{infixr}}
\newcommand{\infix}{\textbf{infix}}

\newcommand{\bigC}{\mathcal{C}}
\newcommand{\bigK}{\mathcal{K}}
\newcommand{\bigA}{\mathcal{A}}
\newcommand{\bigP}{\mathcal{P}}
\newcommand{\bigI}{\mathcal{I}}
\newcommand{\lC}{\lambda_\bigC}

\newcommand{\bax}[1]{\AxiomC{#1}}
\newcommand{\bun}[1]{\UnaryInfC{#1}}
\newcommand{\bbin}[1]{\BinaryInfC{#1}}
\newcommand{\btri}[1]{\TrinaryInfC{#1}}
\newcommand{\bleft}[1]{\LeftLabel{#1}}
\newcommand{\bright}[1]{\RightLabel{#1}}

\newcommand{\thead}[1]{\textit{#1}}
\newcommand{\red}{\twoheadrightarrow}
\newcommand{\sbar}{\;|\;}
\newcommand{\lam}[1]{\lambda #1.\,}
\newcommand{\lmu}[1]{\mu #1.\,}
\newcommand{\ughcenter}[1]{\hspace*{0pt}\hfill #1 \hfill\hspace*{0pt}}

%\interfootnotelinepenalty=100

% TODO:
% - add \noindent after each \end{code}
